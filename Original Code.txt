import streamlit as st
import pandas as pd

st.set_page_config(page_title="Smart Inventory Copilot", layout="wide")

st.title("ðŸ“¦ Smart Inventory Copilot")
st.write("Upload your inventory CSV to get reorder suggestions and insights.")

# Upload CSV
uploaded_file = st.file_uploader("Choose a CSV file", type="csv")

if uploaded_file:
    # Read CSV into dataframe
    df = pd.read_csv(uploaded_file)

    st.subheader("ðŸ“Š Uploaded Data Preview")
    st.dataframe(df)

    # Normalize column names to lowercase for safety
    df.columns = [col.lower() for col in df.columns]

    if 'stock' in df.columns:
        # Set a default reorder point
        df['reorder_point'] = 5

        # Make sure stock is numeric
        df['stock'] = pd.to_numeric(df['stock'], errors='coerce')

        # Calculate reorder need
        df['reorder_needed'] = df['stock'] <= df['reorder_point']

        # Suggested quantity to reorder (fill up to 10 units total)
        df['suggested_reorder_qty'] = df.apply(
            lambda row: max(0, 10 - row['stock']) if row['reorder_needed'] else 0,
            axis=1
        )

        st.subheader("ðŸš¨ Parts to Reorder Soon")
        st.dataframe(df[df['reorder_needed'] == True])
    else:
        st.warning("Your CSV must include a column named `stock`.")
else:
    st.info("Please upload a CSV file to begin.")